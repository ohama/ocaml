<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML
><HEAD
><TITLE
>Mysterious Reduce/Reduce Conflicts</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.7"><LINK
REL="HOME"
TITLE="Ocamlyacc Tutorial"
HREF="ocamlyacc-tutorial.html"><LINK
REL="UP"
TITLE="The Ocamlyacc Parser Algorithm"
HREF="chap-parser-algorithm.html"><LINK
REL="PREVIOUS"
TITLE="Reduce/Reduce Conflicts"
HREF="sec-reduce-reduce-conflicts.html"><LINK
REL="NEXT"
TITLE="Error Recovery"
HREF="chap-error-recovery.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="./ocamlyacc-tutorial.css"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Ocamlyacc Tutorial</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="sec-reduce-reduce-conflicts.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 6. The Ocamlyacc Parser Algorithm</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="chap-error-recovery.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="95%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="sec-mysterious-reduce-reduce-conflicts"
>6.7. Mysterious Reduce/Reduce Conflicts</A
></H1
><P
>&#13;Sometimes reduce/reduce conflicts can occur that don't look warranted.
Here is an example:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;%token ID COMMA COLON

%%
def:    param_spec return_spec COMMA
        ;
param_spec:
             type
        |    name_list COLON type
        ;
return_spec:
             type
        |    name COLON type
        ;
type:        ID
        ;
name:        ID
        ;
name_list:
             name
        |    name COMMA name_list
        ;
</PRE
></TD
></TR
></TABLE
><P
>&#13;It would seem that this grammar can be parsed with only a single token
of look-ahead: when a <TT
CLASS="literal"
>param_spec</TT
> is being read, an <TT
CLASS="literal"
>ID</TT
> is
a <TT
CLASS="literal"
>name</TT
> if a comma or colon follows, or a <TT
CLASS="literal"
>type</TT
> if another
<TT
CLASS="literal"
>ID</TT
> follows.  In other words, this grammar is LR(1).
</P
><P
>&#13;However, Ocamlyacc, like most parser generators, cannot actually handle all
LR(1) grammars.  In this grammar, two contexts, that after an <TT
CLASS="literal"
>ID</TT
>
at the beginning of a <TT
CLASS="literal"
>param_spec</TT
> and likewise at the beginning of
a <TT
CLASS="literal"
>return_spec</TT
>, are similar enough that Ocamlyacc assumes they are the
same.  They appear similar because the same set of rules would be
active---the rule for reducing to a <TT
CLASS="literal"
>name</TT
> and that for reducing to
a <TT
CLASS="literal"
>type</TT
>.  Ocamlyacc is unable to determine at that stage of processing
that the rules would require different look-ahead tokens in the two
contexts, so it makes a single parser state for them both.  Combining
the two contexts causes a conflict later.  In parser terminology, this
occurrence means that the grammar is not LALR(1).
</P
><P
>&#13;In general, it is better to fix deficiencies than to document them.  But
this particular deficiency is intrinsically hard to fix; parser
generators that can handle LR(1) grammars are hard to write and tend to
produce parsers that are very large.  In practice, Ocamlyacc is more useful
as it is now.
</P
><P
>&#13;When the problem arises, you can often fix it by identifying the two
parser states that are being confused, and adding something to make them
look distinct.  In the above example, adding one rule to
<TT
CLASS="literal"
>return_spec</TT
> as follows makes the problem go away:
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;%token BOGUS
...
%%
...
return_spec:
             type
        |    name COMMA type
        /* This rule is never used.  */
        |    ID BOGUS
        ;
</PRE
></TD
></TR
></TABLE
><P
>&#13;This corrects the problem because it introduces the possibility of an
additional active rule in the context after the <TT
CLASS="literal"
>ID</TT
> at the beginning of
<TT
CLASS="literal"
>return_spec</TT
>.  This rule is not active in the corresponding context
in a <TT
CLASS="literal"
>param_spec</TT
>, so the two contexts receive distinct parser states.
As long as the token <TT
CLASS="literal"
>BOGUS</TT
> is never generated by <TT
CLASS="literal"
>yylex</TT
>,
the added rule cannot alter the way actual input is parsed.
</P
><P
>&#13;In this particular example, there is another way to solve the problem:
rewrite the rule for <TT
CLASS="literal"
>return_spec</TT
> to use <TT
CLASS="literal"
>ID</TT
> directly
instead of via <TT
CLASS="literal"
>name</TT
>.  This also causes the two confusing
contexts to have different sets of active rules, because the one for
<TT
CLASS="literal"
>return_spec</TT
> activates the altered rule for <TT
CLASS="literal"
>return_spec</TT
>
rather than the one for <TT
CLASS="literal"
>name</TT
>.
</P
><TABLE
BORDER="0"
BGCOLOR="#e3e3c4"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>&#13;param_spec:
             type
        |    name_list COMMA type
        ;
return_spec:
             type
        |    ID COMMA type
        ;
</PRE
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="95%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="95%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sec-reduce-reduce-conflicts.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="ocamlyacc-tutorial.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="chap-error-recovery.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Reduce/Reduce Conflicts</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="chap-parser-algorithm.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Error Recovery</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>